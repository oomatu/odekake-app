<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ãŠã§ã‹ã‘è¨˜éŒ²</title>
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
</head>

<body>
	<header>
		<div class="header-info">
			ã‚ˆã†ã“ãã€<span th:text="${username}">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</span> ã•ã‚“ï¼ã€€
			<span th:text="${today}">æ—¥ä»˜</span>
		</div>
	</header>

	<h1>
		ãŠã§ã‹ã‘è¨˜éŒ²
		<img src="/images/miffy.png" alt="ãƒŸãƒƒãƒ•ã‚£ãƒ¼"
			style="height: 50px; vertical-align: middle; margin-left: 5px; margin-top: -16px;">
	</h1>

	<div class="nav-buttons">
		<form th:action="@{/inputOdekakeNew}" method="post">
			<input type="hidden" name="category" value="P" />
			<button type="submit">è¿½åŠ ğŸ¡ï¼šå ´æ‰€</button>
		</form>

		<form th:action="@{/inputOdekakeNew}" method="post">
			<input type="hidden" name="category" value="R" />
			<button type="submit">è¿½åŠ ğŸšï¼šã”ã¯ã‚“</button>
		</form>
	</div>

	<div class="list-header">
		<h2 class="subtitle" id="current-list-title">ãŠã§ã‹ã‘ãƒªã‚¹ãƒˆï¼ˆå ´æ‰€ğŸ¡ï¼‰</h2>

		<button class="list-toggle-button" id="show-restaurant-button">è¡¨ç¤ºåˆ‡æ›¿ï¼šã”é£¯å±‹ã•ã‚“ğŸš</button>

		<button class="visited-toggle-button" id="toggle-visited">è¨ªå•çŠ¶æ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹</button>

		<span class="current-view" id="current-visited-status">è¡¨ç¤ºï¼šå…¨ä»¶</span>
	</div>

	<div id="place-section">
		<table id="place-table" class="title-table">
			<thead>
				<tr>
					<th>ID</th>
					<th>ã‚¿ã‚¤ãƒˆãƒ«</th>
					<th>URL</th>
					<th>è¨ªå•çŠ¶æ³</th>
					<th>ä½œæˆè€…</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="info : ${placeList}">
					<td th:text="${info.id}">ID</td>
					<td>
						<a th:href="@{/detailOdekake(id=${info.id}, title=${info.title})}"
							th:text="${info.title}">ã‚¿ã‚¤ãƒˆãƒ«</a>
					</td>
					<td><a th:href="${info.url1}" th:text="${info.url1}">URL</a></td>
					<td th:text="${info.visited}">VISITED</td>
					<td th:text="${info.createdBy}">CREATED_BY</td>
				</tr>
			</tbody>
		</table>
	</div>

	<div id="restaurant-section" style="display: none;">
		<table id="restaurant-table" class="title-table">
			<thead>
				<tr>
					<th>ID</th>
					<th>ã‚¿ã‚¤ãƒˆãƒ«</th>
					<th>URL</th>
					<th>è¨ªå•çŠ¶æ³</th>
					<th>ä½œæˆè€…</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="info : ${restaurantList}">
					<td th:text="${info.id}">ID</td>
					<td>
						<a th:href="@{/detailOdekake(id=${info.id}, title=${info.title})}"
							th:text="${info.title}">ã‚¿ã‚¤ãƒˆãƒ«</a>
					</td>
					<td><a th:href="${info.url1}" th:text="${info.url1}">URL</a></td>
					<td th:text="${info.visited}">VISITED</td>
					<td th:text="${info.createdBy}">CREATED_BY</td>
				</tr>
			</tbody>
		</table>
	</div>

	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script>
		$(document).ready(function () {
			const placeTable = $('#place-table').DataTable({
				language: {url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/ja.json"},
				order: [],
				columnDefs: [
					{targets: [0, 1, 2], orderable: false},
					{targets: [3, 4], visible: false}
				]
			});

			const restaurantTable = $('#restaurant-table').DataTable({
				language: {url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/ja.json"},
				order: [],
				columnDefs: [
					{targets: [0, 1, 2], orderable: false},
					{targets: [3, 4], visible: false}
				]
			});

			let currentCategory = 'place';

			$('#show-restaurant-button').click(function () {
				currentCategory = currentCategory === 'place' ? 'restaurant' : 'place';

				if (currentCategory === 'restaurant') {
					$('#place-section').hide();
					$('#restaurant-section').show();
					$('#current-list-title').text('ãŠã§ã‹ã‘ãƒªã‚¹ãƒˆï¼ˆã”ã¯ã‚“ğŸšï¼‰');
					$(this).text('è¡¨ç¤ºåˆ‡æ›¿ï¼šå ´æ‰€ğŸ¡');
					resetVisitedFilter(false);
					restaurantTable.columns.adjust().draw();
				} else {
					$('#restaurant-section').hide();
					$('#place-section').show();
					$('#current-list-title').text('ãŠã§ã‹ã‘ãƒªã‚¹ãƒˆï¼ˆå ´æ‰€ğŸ¡ï¼‰');
					$(this).text('è¡¨ç¤ºåˆ‡æ›¿ï¼šã”é£¯å±‹ã•ã‚“ğŸš');
					resetVisitedFilter(false);
					placeTable.columns.adjust().draw();
				}
			});

			let visitedMode = 0;

			const tables = {
				'place': placeTable,
				'restaurant': restaurantTable
			};

			/**
			 * @param {boolean} changeMode - visitedModeã‚’ãƒˆã‚°ãƒ«ã™ã‚‹ã‹ã©ã†ã‹ (true: ãƒˆã‚°ãƒ«ã™ã‚‹, false: ãƒˆã‚°ãƒ«ã—ãªã„/ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ç¶­æŒ)
			 */
			function resetVisitedFilter(changeMode) {
				const currentTable = tables[currentCategory];

				if (changeMode) {
					visitedMode = (visitedMode + 1) % 3;
				} else {
					visitedMode = 0;
				}

				let filterValue = '';
				let statusText = 'è¡¨ç¤ºï¼šå…¨ä»¶';

				if (visitedMode === 1) {
					filterValue = 'Y';
					statusText = 'è¡¨ç¤ºï¼šè¡Œã£ãŸã“ã¨ã‚ã‚‹';
				} else if (visitedMode === 2) {
					filterValue = 'N';
					statusText = 'è¡¨ç¤ºï¼šè¡Œã£ãŸã“ã¨ãŒãªã„';
				}

				currentTable.columns(3).search(filterValue).draw();
				$('#current-visited-status').text(statusText);
			}

			$('#toggle-visited').click(function () {
				resetVisitedFilter(true);
			});

			resetVisitedFilter(false);
		});
	</script>
</body>

</html>